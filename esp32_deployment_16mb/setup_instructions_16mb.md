# Инструкция по установке ESP32 16MB - Полная версия

## Требования к оборудованию

### ESP32 с 16MB Flash
- **Рекомендуемые модели:**
  - ESP32-WROVER-IE (16MB Flash + 8MB PSRAM)
  - ESP32-WROVER-E (16MB Flash + 8MB PSRAM)
  - ESP32-S3-WROOM-1-N16R8 (16MB Flash + 8MB PSRAM)

### Проверка характеристик ESP32
```bash
# В Serial Monitor ESP32 должно показать:
Flash size: 16MB (16777216 bytes)
PSRAM size: 8MB (8388608 bytes)
```

## Подготовка среды разработки

### Вариант A: PlatformIO (рекомендуется)
1. Установите VS Code
2. Установите расширение PlatformIO
3. Откройте папку `esp32_deployment_16mb` как проект

### Вариант B: Arduino IDE
1. Установите Arduino IDE 2.0+
2. Добавьте поддержку ESP32
3. Выберите плату "ESP32 Wrover Module"
4. Установите библиотеки:
   - ArduinoJson 6.21.3+
   - ESP Async WebServer 1.2.3+
   - AsyncTCP 1.1.1+
   - WebSockets 2.4.0+

## Сборка и развертывание

### Шаг 1: Сборка веб-интерфейса
```bash
# Установка зависимостей Node.js
npm install

# Сборка оптимизированного интерфейса
node build_web_interface.js
```

### Шаг 2: Настройка WiFi
Отредактируйте `main.cpp`:
```cpp
const char* ssid = "YOUR_WIFI_SSID";
const char* password = "YOUR_WIFI_PASSWORD";
```

### Шаг 3: Загрузка кода
```bash
# PlatformIO
pio run --target upload

# Arduino IDE
# Compile and Upload через интерфейс
```

### Шаг 4: Загрузка веб-файлов
```bash
# Автоматическая загрузка через WiFi
node upload_to_esp32.js --esp32-ip=192.168.1.100

# Или через PlatformIO
pio run --target uploadfs
```

## Конфигурация памяти 16MB

### Разделение Flash памяти
```
16MB Flash Layout:
├── 4MB  - app0 (основная программа)
├── 4MB  - app1 (OTA обновления)
├── 8MB  - LittleFS (веб-файлы + данные)
```

### Размер компонентов
```
Веб-интерфейс:      ~3-5MB
Данные станций:     ~1MB
Логи системы:       ~0.5MB
Резерв:             ~3.5MB
```

## Возможности 16MB версии

### Увеличенные лимиты
- **Станции**: До 50 (vs 10 в базовой версии)
- **Подключения**: До 20 одновременных
- **Данные**: Полная история операций
- **Интерфейс**: Полный React со всеми компонентами

### Дополнительные функции
- WebSocket для real-time обновлений
- OTA обновления через веб-интерфейс
- Система логирования
- Темная/светлая тема
- Расширенная валидация
- Детальная аналитика

## Мониторинг и отладка

### Serial Monitor
```bash
# PlatformIO
pio device monitor

# Arduino IDE
# Tools → Serial Monitor (115200 baud)
```

### Веб-интерфейс отладки
- Системная информация: `http://ESP32_IP/api/system/info`
- Логи: `http://ESP32_IP/api/system/logs`
- Статистика памяти: WebSocket сообщения

## Производительность

### Ожидаемые характеристики
- **Время загрузки**: 2-3 секунды для полного интерфейса
- **Отклик API**: < 50ms для простых запросов
- **WebSocket**: Обновления каждые 5 секунд
- **Память**: 200-300KB heap, 1-2MB PSRAM

### Оптимизация производительности
```cpp
// В main.cpp уже настроены оптимальные параметры:
#define MAX_CONCURRENT_CLIENTS 20
#define WEBSOCKET_UPDATE_INTERVAL 5000
#define JSON_BUFFER_SIZE 8192
```

## OTA обновления

### Через веб-интерфейс
1. Скомпилируйте новую версию
2. Зайдите в веб-интерфейс → Система → Обновления
3. Загрузите файл `.bin`
4. ESP32 автоматически перезагрузится

### Через WiFi
```bash
# PlatformIO с OTA
pio run --target upload --upload-port ESP32_IP
```

## Устранение проблем

### ESP32 не загружается
- Проверьте правильность разделов памяти
- Убедитесь, что выбрана плата с 16MB Flash
- Проверьте, что используется правильный файл `partitions_16mb.csv`

### Веб-интерфейс не загружается
```bash
# Проверка размера файлов
ls -la data/dist/

# Проверка загрузки в LittleFS
curl http://ESP32_IP/api/system/info
```

### Недостаточно памяти
- Уменьшите количество одновременных подключений
- Оптимизируйте JSON буферы
- Используйте PSRAM для больших объектов

### WebSocket не работает
- Проверьте порт 81
- Убедитесь, что брандмауэр не блокирует соединение
- Проверьте логи в Serial Monitor

## Сравнение версий

| Функция | 4MB версия | 16MB версия |
|---------|------------|-------------|
| Станции | 10 | 50 |
| Интерфейс | Простой HTML | Полный React |
| Подключения | 4-8 | 20+ |
| WebSocket | Нет | Да |
| OTA | Нет | Да |
| Темы | Нет | Да |
| Логирование | Базовое | Расширенное |
| Время загрузки | < 1с | 2-3с |
| Размер | ~2MB | ~5MB |

## Масштабирование

### Для больших сетей (50+ станций)
- Используйте несколько ESP32 в режиме master-slave
- Реализуйте распределенную архитектуру
- Добавьте внешнюю базу данных

### Интеграция с облаком
- MQTT для передачи данных
- HTTP API для внешних систем
- WebSocket для real-time мониторинга

## Безопасность

### Рекомендации
- Смените пароль точки доступа
- Используйте HTTPS (требует дополнительной настройки)
- Ограничьте доступ к административным функциям
- Регулярно обновляйте прошивку

### Аутентификация
```cpp
// В main.cpp можно добавить:
server.on("/admin", HTTP_GET, [](AsyncWebServerRequest *request){
    if (!request->authenticate("admin", "password")) {
        return request->requestAuthentication();
    }
    // Административный интерфейс
});
```