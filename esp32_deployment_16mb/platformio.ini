[env:esp32-16mb]
platform = espressif32
board = esp32-wrover-kit
framework = arduino

; Настройки для 16MB памяти
board_build.partitions = partitions_16mb.csv
board_build.filesystem = littlefs

; Библиотеки для расширенной функциональности
lib_deps = 
    ArduinoJson@^6.21.3
    ESP32WebServer
    ESP Async WebServer@^1.2.3
    AsyncTCP@^1.1.1
    WebSockets@^2.4.0
    LittleFS_esp32@^1.0.6

; Настройки загрузки
monitor_speed = 115200
upload_speed = 921600

; Дополнительные флаги компиляции для 16MB
build_flags = 
    -DCORE_DEBUG_LEVEL=1
    -DCONFIG_ARDUHAL_LOG_COLORS=1
    -DBOARD_HAS_PSRAM
    -DCONFIG_SPIRAM_SUPPORT=1
    -DCONFIG_SPIRAM_USE_MALLOC=1
    -DCONFIG_SPIRAM_CACHE_WORKAROUND=1
    -DARDUINO_RUNNING_CORE=1
    -DARDUINO_EVENT_RUNNING_CORE=1
    -DESP32_16MB_BUILD

; Настройки памяти для больших приложений
build_unflags = -Os
build_flags = ${env.build_flags} -O2

; Увеличенный размер стека для WebSocket и JSON обработки
board_build.arduino.memory_type = qio_opi

[env:esp32-16mb-ota]
extends = env:esp32-16mb
upload_protocol = espota
upload_port = 192.168.1.100  ; IP адрес ESP32
upload_flags = --auth=charging2025